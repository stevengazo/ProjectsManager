@model ProjectsControl.Models.Project

@{
    ViewData["Title"] = $"Detalles {Model.ProjectName}";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



<h1>Detalles del Proyecto</h1>
<p>A continuación se muestra la información registada del proyecto @Model.ProjectName, para mayor información contacte a los encargados respectivos. </p>
<div>
    <a asp-action="Edit" asp-route-id="@Model.ProjectId">Editar información</a> |
</div>
<hr class="bg-light" />
<table class="table table-hover table-striped table-responsive-sm table-bordered" style="font-size: 13px;text-align:center">
    <tbody>
        <tr>
            <th>Nombre de Tarea</th>
            <td>@Html.DisplayFor(model => model.NumberOfTask)</td>
        </tr>
        <tr>
            <th>Nombre del Proyecto</th>
            <td>@Html.DisplayFor(model => model.ProjectName)</td>
        </tr>
        <tr>
            <th>Id Orden de Compra</th>
            <td>@Html.DisplayFor(model => model.OC)</td>
        </tr>
        <tr>
            <th>Fecha de Compra</th>
            <td>@Html.DisplayFor(model => model.OCDate)</td>
        </tr>
        <tr>
            <th>Monto</th>
            <td>@Html.DisplayFor(model => model.Amount)</td>
        </tr>
        <tr>
            <th>Moneda</th>
            <td>@Html.DisplayFor(model => model.Currency)</td>
        </tr>
        <tr>
            <th>Encargado</th>
            <td>@Html.DisplayFor(M => M.Manager)</td>
        </tr>
        <tr>
            <th>Fecha de Inicio</th>
            <td>@Html.DisplayFor(model => model.BeginDate)</td>
        </tr>
        <tr>
            <th>Fecha Finalizacion</th>
            <td>@Html.DisplayFor(model => model.EndDate)</td>
        </tr>
        <tr>
            <th>Finalizado</th>
            <td>@Html.DisplayFor(model => model.IsOver)</td>
        </tr>
        <tr>
            <th>Tipo de Trabajo</th>
            <td>@Html.DisplayFor(model => model.TypeOfJob)</td>
        </tr>
        <tr>
            <th>Detalles</th>
            <td>@Html.DisplayFor(model => model.Details)</td>
        </tr>
        <tr>
            <th>Ubicacion</th>
            <td>@Html.DisplayFor(model => model.Ubication)</td>
        </tr>
        <tr>
            <th>Cliente</th>
            <td>@Html.DisplayFor(model => model.Customer.Name)</td>
        </tr>
        <tr>
            <th>Vendedor</th>
            <td>@Html.DisplayFor(model => model.Employee.Name)</td>
        </tr>
    </tbody>
</table>

<div>
    <h2>Gastos Registrados en el Proyecto</h2>
    <p>A continuación se muestran los gastos registrados en el proyecto, clasificados por tipo.</p>
    <div>
        <a class="btn btn-success" asp-controller="Expensives" asp-action="CreateByProject" asp-route-id="@Model.ProjectId">Registrar Nuevo Gasto</a>
    </div>


    <table class="table table-hover table-striped table-responsive-sm table-bordered" style="font-size: 17px;text-align:center">
        <thead>
            <tr>
                <th>Tipo de Gasto</th>
                <th>Gasto Registrado</th>
            </tr>
        </thead>
        <tbody>
            @{
                Dictionary<string, float> Exp = ViewBag.ExpensivesByType;
                foreach (var item in Exp)
                {
                                    <tr>
                                        <td>@item.Key</td>
                                        <td>@item.Value</td>
                                    </tr>
                }
            }
        </tbody>
    </table>
</div>

<div>
    <h2>Facturas Registradas</h2>
    <p> A continuación se muestras las facturas realizadas por Grupo Mecsa a el cliente @Model.Customer.Name, para mayor detalle favor consulte con el departamento financiero o con el encargado de la realización de la facturas registradas.</p>
    <div>
        <a class="btn btn-success" asp-controller="Bills" asp-action="Create">Registrar Nueva Factura</a> |
    </div>
    <hr class="bg-light" />
    <table class="table table-hover table-striped table-responsive-sm table-bordered" style="font-size: 17px;text-align:center">
        <thead>
            <tr>
                <th>
                    Número de Factura
                </th>
                <th>
                    Fecha de Creación
                </th>
                <th>
                    Autor
                </th>
                <th>
                    Monto
                </th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in ViewBag.BillsOfProyect)
            {
                <tr>
                    <td>
                        @item.NumberOfBill
                    </td>
                    <td>
                        @item.DateOfCreation
                    </td>
                    <td>
                        @item.Author
                    </td>
                    <td>
                        @item.Amount
                    </td>
                    <td>
                        <a class="btn btn-info" asp-controller="Bills" asp-action="Edit" asp-route-id="@item.BillId">Editar</a> |
                        <a class="btn btn-primary" asp-controller="Bills" asp-action="Details" asp-route-id="@item.BillId">Detalles</a> |
                        <a class="btn btn-danger" asp-controller="Bills" asp-action="Delete" asp-route-id="@item.BillId">Borrar</a>
                    </td>
                </tr>

            }
        </tbody>
    </table>
</div>

<div>
    <h3>Notas y Bitacorá del Proyecto</h3>
    <p>A continuación las notas realizadas con respecto al proyecto e información referente a su ejecución. Algunas ideas de la información a registrar es:</p>
    <ul>
        <li> Incidentes del Proyecto.</li>
        <li> Conflictos en el sitio.</li>
        <li> Cambios en la ejecución del proyecto.</li>
    </ul>
    <div>
        <a class="btn btn-success" asp-controller="Notes" asp-action="CreateByProject" asp-route-id="@Model.ProjectId">Registrar Nueva Nota</a>
    </div>
    <hr class="bg-light" />
    <table class="table table-hover table-striped table-responsive-sm table-bordered  " style="font-size: 16px;text-align:center">
        <thead>
            <tr>
                <th>
                    Autor
                </th>
                <th>
                    Fecha Creación
                </th>
                <th>
                    Titulo
                </th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in ViewBag.Notes)
            {
                <tr>
                    <td>
                        @item.Author
                    </td>
                    <td>
                        @item.DateOfCreation
                    </td>
                    <td>
                        @item.Title
                    </td>
                    <td>
                        <a class="btn btn-primary" asp-controller="Notes" asp-action="Details" asp-route-id="@item.NotesId">Ver</a> |
                        <a class="btn btn-danger" asp-controller="Notes" asp-action="Delete" asp-route-id="@item.NotesId">Eliminar</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>

</div>
<div>
    <h3>Informes Registrados</h3>
    <p>Informes existentes en la base de datos correspondientes al presente proyecto. A continuación se muestra la cantidad de informes registrados de este proyecto, así como el estato de cada uno. Para mayor información consulte al departamento de ingeniería o al encargado de la redacción del informe.</p>
    <div class="d-flex justify-content-lg-start">
        <a class="btn btn-success" asp-controller="Reports" asp-action="CreateByProject" asp-route-id="@Model.ProjectId">Registrar Nuevo Informe</a>
    </div>
    <hr class="bg-light" />
    <table class="table table-hover table-striped table-responsive-sm table-bordered  " style="font-size: 16px;text-align:center">
        <thead>
            <tr>
                <th>
                    Numero de Reporte
                </th>
                <th>
                    Autor
                </th>
                <th>
                    Inicio
                </th>
                <th>
                    Fin
                </th>
                <th>
                    Estado
                </th>
                <th>
                    Notas
                </th>
                <th></th>
            </tr>
        </thead>
        <tbody style="font-size: 12px;">
            @foreach (var item in ViewBag.Reports)
            {
                <tr>
                    <td>
                        @item.NumberOfReport
                    </td>
                    <td>
                        @item.Author
                    </td>
                    <td>
                        @item.BeginDate
                    </td>
                    <td>
                        @item.EndDate
                    </td>
                    <td>
                        @item.Status
                    </td>
                    <td>
                        @item.Notes
                    </td>
                    <td>
                        <a class="btn btn-info btn-sm " asp-controller="Reports" asp-action="Edit" asp-route-id="@item.ReportId">Editar</a> |
                        <a class="btn btn-primary btn-sm " asp-controller="Reports" asp-action="Details" asp-route-id="@item.ReportId">Detalles</a> |
                        <a class="btn btn-danger btn-sm" asp-controller="Reports" asp-action="Delete" asp-route-id="@item.ReportId">Eliminar</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
<div>
    <h3>Asistencias Registradas del Proyecto</h3>
    <p>Asistencias del proyecto registradas por empleado. Dichas asistencias identifican el personal encargado de la realización proyecto. Asimismo se muestra la siguiente informacíon:</p>
    <ul>
        <li>Cantidad Total de horas registradas por persona empleadas en el proyecto.</li>
        <li>Cantidad total de dias registrados por persona empleados en el proyecto.</li>
    </ul>
    <div class="d-flex justify-content-between">
        <a class="btn btn-success" asp-controller="Asistances" asp-action="Create">Registrar Nueva asistencia</a>
        <!-- Default switch -->
        <div class="custom-control custom-switch">
            <input type="checkbox" onclick="onclickedAsistances(this)" class="custom-control-input" id="customSwitches">
            <label id="lblToogleAsistances" class="custom-control-label" for="customSwitches"></label>
        </div>
    </div>
    <hr />

    <table id="table-asistances-resume" class="table table-hover table-striped table-responsive-sm table-bordered  " style="font-size: 16px;text-align:center">
        <thead>
            <tr>
                <th>
                    Persona
                </th>
                <th>
                    Horas
                </th>
                <th>
                    Dias
                </th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in ViewBag.Hours)
            {
                @foreach (var i in ViewBag.DaysOfEmployees)
                {
                    @if (item.Key.Equals(i.Key))
                    {
                        <tr>
                            <td>
                                @item.Key
                            </td>
                            <td>
                                @item.Value
                            </td>
                            <td>
                                @i.Value
                            </td>
                        </tr>
                    }
                }
            }
        </tbody>
    </table>

</div>



<table id="table-asistances-details" class="table table-hover   table-striped table-responsive-sm table-bordered" style="font-size: 13px;text-align:center">
    <thead>
        <tr>
            <th>
                Día de Inicio
            </th>
            <th>
                Día Finalización
            </th>
            <th>
                Empleado
            </th>
            <th>
                N° Semana
            </th>
            <th>
                Acciones
            </th>
        </tr>
    </thead>
    <tbody>
        @foreach (Asistance item in ViewBag.AsistancesDetails)
        {
            <tr>
                <td>
                    @item.DateOfBegin
                </td>
                <td>
                    @item.DateOfEnd
                </td>
                <td>
                    @item.Employee.Name
                </td>
                <td>
                    @item.NumberOfWeek
                </td>
                <td>
                    <a class="btn btn-primary btn-sm" asp-controller="Asistances" asp-action="Details" asp-route-id="@item.AsistanceId">Ver</a>
                </td>
            </tr>
        }
    </tbody>
</table>


<div>
    <h3>Horas Extras Registradas</h3>
    <p>Cantidad de horas extras registradas por persona en el proyecto actual</p>
    <hr class="bg-light" />
    <!-- Default switch -->
    <div class="d-flex justify-content-end">
        <div class="custom-control custom-switch">
            <input type="checkbox" onclick="onclickedExtras(this)" class="custom-control-input" id="extraHourSwitches">
            <label id="lblToogleExtras" class="custom-control-label" for="extraHourSwitches"></label>
        </div>
    </div>

    <!-- TABLA RESUMEN-->
    <table id="table-extras-resumen" class="table table-hover table-striped table-responsive-sm table-bordered  " style="font-size: 16px;text-align:center">
        <thead>
            <tr>
                <th>Persona</th>
                <th>Horas</th>
            </tr>
        </thead>
        <tbody style="font-size: 12px;">
            @foreach (var item in ViewBag.Extras)
            {
                if (item.Value != 0)
                {
                    <tr>
                        <td>
                            @item.Key
                        </td>
                        <td>
                            @(item.Value)
                        </td>
                    </tr>
                }

            }
        </tbody>
    </table>
    <!--TABLA DETALLES-->
    <table id="table-extras-details" class="table table-hover table-striped table-responsive-sm table-bordered  " style="font-size: 16px;text-align:center">
        <thead>
            <tr>
                <th>Persona</th>
                <th>Hora Inicio</th>
                <th>Hora Final</th>
                <th>Cantidad Tiempo</th>
                <th>Tipo Hora</th>
            </tr>
        </thead>
        <tbody style="font-size: 12px;">
            @foreach (ExtraHour item in ViewBag.ExtrasDetails)
            {
                <tr>
                    <td>
                        @item.Employee.Name
                    </td>
                    <td>
                        @item.BeginTime
                    </td>
                    <td>
                        @item.EndTime
                    </td>
                    <td>
                        @(item.EndTime-item.BeginTime) Time
                    </td>
                    <td>
                        @item.TypeOfHour
                    </td>
                    <td>
                        <a class="btn btn-sm btn-info" asp-controller="ExtraHours" asp-action="Details" asp-route-id="@item.ExtraHourId">Ver</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>





<script>


    // iNTERCHANGE OF TABLES WITH THE TOOGLE
    let toogleAsistances = document.getElementById("customSwitches");
    let tableresumen = document.getElementById("table-asistances-resume");
    let tableDetails = document.getElementById("table-asistances-details");

    tableDetails.style.display = "none";
    console.log(tableresumen);
    console.log(tableDetails);
    console.log(toogleAsistances);

    let lbltoogle = document.getElementById("lblToogleAsistances");
    lbltoogle.innerText = "Vista Detallada";
    const onclickedAsistances = (element) => {
        if (element.checked !== true) {
            lbltoogle.innerText = "Vista Resumen";
            tableresumen.style.display = "";
            tableDetails.style.display = "none";

        } else {

            lbltoogle.innerText = "Vista Detallada";
            tableresumen.style.display = "none";
            tableDetails.style.display = "";

        }

    };



    let tableExtrasResumen = document.getElementById("table-extras-resumen");
    let tableExtrasDetails = document.getElementById("table-extras-details");
    tableExtrasDetails.style.display = "none";
    let lbltoogleExtras = document.getElementById("lblToogleExtras");
    lbltoogleExtras.innerText = "Vista Detallada";

    const onclickedExtras = (element) => {
        if (element.checked !== true) {
            lbltoogleExtras.innerText = "Vista Resumen";
            tableExtrasResumen.style.display = "";
            tableExtrasDetails.style.display = "none";

        } else {

            lbltoogleExtras.innerText = "Vista Detallada";
            tableExtrasResumen.style.display = "none";
            tableExtrasDetails.style.display = "";

        }

    };


</script>
